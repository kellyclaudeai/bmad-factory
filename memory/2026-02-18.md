# 2026-02-18 Daily Notes

[Previous content preserved above...]

---

## CLI-First Policy Enforcement (16:29-16:36 CST)

### Problem Identified
**Operator flagged:** NoteLite story 1.2 (Firebase setup) appeared to use excessive browser automation based on session logs showing screenshots and browser activity.

**User question:** "Are we sure it didn't use browser automation a lot? I saw a couple screenshots being taken and stuff though."

### Investigation
**Story 1.2 actual breakdown** (from completion notes):
- âœ… CLI-based (80%): gcloud projects create, firebase CLI, npm install, API enablement
- ðŸŒ Browser-based (20%): Firestore database creation (region selection), Firebase Auth Google provider (consent screen)
- **Amelia's reasoning:** `firebase-cli` skill explicitly says Auth provider setup can require browser when interactive

**Log volume skew:** Browser automation generates verbose output (CDP messages, snapshots, element trees) while CLI commands are one-liners â†’ created impression of "mostly browser" when effort was inverted

### Root Cause Analysis
**User insight:** "I want to solve it upstream so future problems avoid using the UI/Browser as much as possible. The problem was in the BMAD planning it looks like. It's assuming the human operator will be working with it, not an automated factory."

**Key finding:** BMAD workflows are designed for interactive human collaboration ("Navigate to Firebase Console â†’ Click Add Project"). Winston and Bob were writing planning artifacts for humans, but **Amelia executes them autonomously**.

**Mismatch chain:**
1. BMAD workflows â†’ interactive/collaborative by design
2. Winston runs workflow â†’ outputs architecture.md with "Navigate to console"  
3. Bob reads architecture â†’ writes story tasks as "Click X, fill Y"
4. Amelia reads story â†’ uses browser automation (follows instructions literally)

### Solution: Upstream Fix via Workspace Wrappers

**Operator clarification:** "I'd rather you dont touch BMAD workflow templates and instead we could add wrappers around things like Winston/Bob? Not totally sure."

**Approach taken:** Workspace config wrappers (NOT BMAD templates)

**Files updated:**

1. **`docs/factory-principles.md`** (NEW)
   - Created comprehensive factory principles document
   - **Principle #1:** CLI-first policy (browser as absolute last resort)
   - Defines when CLI vs browser is appropriate
   - Applies to ALL agents (planning, implementation, testing)

2. **`workspaces/bmad-bmm-winston/AGENTS.md`**
   - Added "ðŸ­ FACTORY AUTOMATION CONTEXT" section
   - Explicit: "Your output will be executed by AGENTS, not humans"
   - Setup procedures â†’ CLI commands (not "Navigate to console")
   - Includes CLI examples (Firebase, Vercel, GitHub)
   - CLI-based setup section in architecture template guidance

3. **`workspaces/bmad-bmm-bob/AGENTS.md`**
   - Added "ðŸ­ FACTORY AUTOMATION CONTEXT" section
   - Story tasks â†’ CLI commands (not browser instructions)
   - CLI-first task writing examples (GOOD vs BAD)
   - Clarifies: Amelia/Barry will execute these literally

4. **`workspaces/bmad-bmm-amelia/TOOLS.md`**
   - Added "## CLI-First Policy (CRITICAL)" section
   - Explicit guidance: Default to CLI, browser only as last resort
   - Firebase CLI examples (gcloud + firebase commands)
   - **Override authority:** "If story says browser but CLI exists, OVERRIDE the story"

5. **`docs/factory-overview.md`**
   - Updated to reference factory-principles.md
   - Added link in header

**What was NOT touched:**
- âŒ `projects/*/._bmad/bmm/workflows/*.md` â€” BMAD templates left alone
- âŒ Any `_bmad/` directory structures
- âœ… Only workspace AGENTS.md/TOOLS.md files (wrapper approach)

### Impact Assessment

**Before this fix:**
- Winston architecture.md: "Create Firebase project in console" â†’ browser automation
- Story 1.2 tasks: List of UI click instructions â†’ slow, verbose logs

**After this fix:**
- Winston architecture.md: "Run `gcloud projects create && firebase projects:addfirebase`" â†’ CLI
- Story 1.2 tasks: Executable bash commands â†’ fast, deterministic

**Current NoteLite project:** Story 1.2 is already complete and accepted (80% CLI, 20% browser for genuinely interactive steps). No action needed.

**Next projects:** Planning artifacts will be CLI-first by default. Browser only when NO CLI exists.

### Key Decisions

1. **Story 1.2 accepted as-is** â€” Working, committed, followed existing guidance
2. **Wrapper approach confirmed** â€” Workspace configs, not BMAD templates
3. **Factory-wide principles codified** â€” CLI-first is now factory principle #1
4. **Agent context added** â€” Winston/Bob know they're writing for agent execution

### Commits

- `eb94fb1` â€” docs: Add factory-wide CLI-first policy (factory-principles.md, Amelia TOOLS.md, Winston/Bob AGENTS.md)
- `2cce900` â€” docs: Add Factory Automation Context to Winston and Bob
- `0008d77` â€” docs: Log CLI-first upstream fix in changelog

### Lessons Learned

**Design pattern validated:** Workspace wrappers can adapt BMAD workflows to factory context without modifying BMAD itself. This allows:
- BMAD workflows to remain human-friendly for manual use
- Factory agents to receive automation-specific guidance
- Separation of concerns (BMAD = workflow, workspace = execution context)

**Log volume â‰  actual work:** Verbose tool output (browser logs) can misrepresent where effort is spent. Check completion notes for ground truth.

**Upstream > downstream:** Fixing planning artifacts (architecture, stories) prevents downstream patching in implementation. Better to write CLI-based stories than have Amelia override them.

---

_End of 2026-02-18 daily notes. Total session time: ~6 hours (10:00-16:36 CST)._

---

## CLI-First Policy Enforcement (16:29-16:36 CST)

### Problem Identified
**Operator flagged:** NoteLite story 1.2 (Firebase setup) appeared to use excessive browser automation based on session logs showing screenshots and browser activity.

**User question:** "Are we sure it didn't use browser automation a lot? I saw a couple screenshots being taken and stuff though."

### Investigation
**Story 1.2 actual breakdown** (from completion notes):
- âœ… CLI-based (80%): gcloud projects create, firebase CLI, npm install, API enablement
- ðŸŒ Browser-based (20%): Firestore database creation (region selection), Firebase Auth Google provider (consent screen)
- **Amelia's reasoning:** `firebase-cli` skill explicitly says Auth provider setup can require browser when interactive

**Log volume skew:** Browser automation generates verbose output (CDP messages, snapshots, element trees) while CLI commands are one-liners â†’ created impression of "mostly browser" when effort was inverted

### Root Cause Analysis
**User insight:** "I want to solve it upstream so future problems avoid using the UI/Browser as much as possible. The problem was in the BMAD planning it looks like. It's assuming the human operator will be working with it, not an automated factory."

**Key finding:** BMAD workflows are designed for interactive human collaboration ("Navigate to Firebase Console â†’ Click Add Project"). Winston and Bob were writing planning artifacts for humans, but **Amelia executes them autonomously**.

**Mismatch chain:**
1. BMAD workflows â†’ interactive/collaborative by design
2. Winston runs workflow â†’ outputs architecture.md with "Navigate to console"  
3. Bob reads architecture â†’ writes story tasks as "Click X, fill Y"
4. Amelia reads story â†’ uses browser automation (follows instructions literally)

### Solution: Upstream Fix via Workspace Wrappers

**Operator clarification:** "I'd rather you dont touch BMAD workflow templates and instead we could add wrappers around things like Winston/Bob? Not totally sure."

**Approach taken:** Workspace config wrappers (NOT BMAD templates)

**Files updated:**

1. **`docs/factory-principles.md`** (NEW)
   - Created comprehensive factory principles document
   - **Principle #1:** CLI-first policy (browser as absolute last resort)
   - Defines when CLI vs browser is appropriate
   - Applies to ALL agents (planning, implementation, testing)

2. **`workspaces/bmad-bmm-winston/AGENTS.md`**
   - Added "ðŸ­ FACTORY AUTOMATION CONTEXT" section
   - Explicit: "Your output will be executed by AGENTS, not humans"
   - Setup procedures â†’ CLI commands (not "Navigate to console")
   - Includes CLI examples (Firebase, Vercel, GitHub)

3. **`workspaces/bmad-bmm-bob/AGENTS.md`**
   - Added "ðŸ­ FACTORY AUTOMATION CONTEXT" section
   - Story tasks â†’ CLI commands (not browser instructions)
   - CLI-first task writing examples (GOOD vs BAD)

4. **`workspaces/bmad-bmm-amelia/TOOLS.md`**
   - Added "## CLI-First Policy (CRITICAL)" section
   - Firebase CLI examples, override authority

5. **`docs/factory-overview.md`**
   - Updated to reference factory-principles.md

**What was NOT touched:**
- âŒ BMAD workflow templates (`_bmad/` directories)
- âœ… Only workspace wrappers (AGENTS.md/TOOLS.md files)

### Impact

**Before:** Architecture docs with browser instructions â†’ slow implementation
**After:** Architecture docs with CLI commands â†’ fast, deterministic

**Story 1.2:** Accepted as-is (80% CLI already, followed existing guidance)
**Future projects:** Planning artifacts will be CLI-first by default

### Commits

- `eb94fb1` â€” docs: Add factory-wide CLI-first policy
- `2cce900` â€” docs: Add Factory Automation Context to Winston and Bob
- `0008d77` â€” docs: Log CLI-first upstream fix in changelog

### Lessons Learned

1. **Workspace wrappers work** â€” Can adapt BMAD workflows without modifying templates
2. **Log volume â‰  actual work** â€” Browser logs are verbose; check completion notes
3. **Upstream > downstream** â€” Fix planning artifacts, not implementation patches

---

_End of 2026-02-18 daily notes._
