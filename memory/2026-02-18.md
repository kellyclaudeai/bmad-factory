# Memory Log â€” 2026-02-18

## Major Events

### Research Lead Sessions (Complete)
- **Session 1 (Prepwise)**: Shopping list budget tracker, scored 46/50. Output: `projects/ideas/smart-receipt-budgeting-tracker-2026-02-18-1656/intake.md`
- **Session 2 (ClaimDone)**: Warranty claim concierge, scored 43/50. Output: `projects/ideas/warranty-receipt-tracker-2026-02-18-1733/intake.md`
- **Session 3 (PULSE)**: Hyperlocal event discovery, scored 40/50. Output: `projects/ideas/hyper-local-event-discovery-2026-02-18-1824/intake.md`
- **Session 4**: Running, using new workspace (`workspaces/research-lead/`)

### NoteLite Implementation Progress
- 16+ stories complete (~30%+), stalled due to zombie subagent bug
- Stories completed today: 3.5 (Slash Command), 4.6 (Page Navigation), 8.3 (Firestore Indexes)

### Directory Restructure
- Created `projects/ideas/` for Research Lead outputs
- Registry updated to v1.1 with `researchDir` field
- Updated 4 core docs: project-registry-workflow, research-lead-flow, project-lead-flow, kelly-router-flow

### Gateway SIGTERM Incident (19:07 CST)
- External SIGTERM killed 9 running agents mid-execution
- openclaw.json was stripped to only `research-lead` at 19:16
- Restored config from backup at 19:23
- Added all 16 agents back at 19:30

## ðŸ”¬ ZOMBIE SUBAGENT BUG â€” ROOT CAUSE FOUND (20:47 CST)

### Symptom
- NoteLite PL session spawns subagents, ~85% become zombies (0 tokens, never process)
- Fresh PL session (no heartbeat) spawns 4/4 successfully in parallel

### Root Cause (CONFIRMED via error logs)
**PL heartbeat on `nested` lane (concurrency 1) blocks subagent announce-back.**

The announce-back mechanism:
1. Subagent completes work (~5 seconds)
2. Subagent tries to announce result back to parent PL session
3. Announce must go through PL's command queue on `nested` lane (concurrency 1)
4. If PL is busy (heartbeat turn), announce waits in queue
5. After 60s timeout, announce fails â†’ result lost
6. PL's next heartbeat sees 0 active subagents â†’ re-spawns â†’ cycle repeats

### Evidence
```
02:47:26 UTC â€” Subagent announce failed: Error: gateway timeout after 60000ms (x4)
02:47:26 UTC â€” announce queue drain failed for agent:project-lead:project-notelite
```
Timeline: PL spawned 4 agents at 20:46:26, all 4 announce-backs failed at 20:47:26 (exactly 60s later = heartbeat interval).

### OpenClaw Lane Architecture (from source code)
- 4 lanes: `main` (24), `cron` (1), `subagent` (96), `nested` (unconfigured â†’ defaults to 1)
- `sessions_spawn` hardcodes `lane: AGENT_LANE_SUBAGENT` (concurrency 96) â€” works fine
- `gateway call agent` defaults `lane: AGENT_LANE_NESTED` (concurrency 1) â€” bottleneck
- Heartbeat fires PL turns on nested lane, blocking announce-back delivery
- Key source files: `reply-DptDUVRg.js` (line ~49916), `gateway-cli-DZge3TdL.js` (line ~10072)

### Fix Applied (20:49 CST)
- Removed PL heartbeat from openclaw.json
- PL now inherits default heartbeat (`target: none` = disabled)
- Gateway restarted via SIGUSR1

### Test In Progress (20:55 CST)
- Fresh PL-v2 session (`agent:project-lead:project-notelite-v2`) spawned
- 2 Amelias spawned: story 3.8 (arrow nav fix) + story 2.1 (auth completion)
- Monitoring for announce-back success (first real test without heartbeat)

## Lessons Learned
1. **OpenClaw `nested` lane concurrency 1 is a critical bottleneck** â€” any agent using `gateway call agent` shares this lane
2. **Heartbeat + subagent spawning = deadlock** â€” heartbeat occupies the lane, preventing subagent results from being delivered
3. **Fresh sessions work, bloated sessions don't** â€” not because of context size, but because heartbeat is only active on sessions that have been running long enough to trigger it
4. **Error logs are the smoking gun** â€” `gateway.err.log` showed "Subagent announce failed" which immediately confirmed the hypothesis

## Key Config State (end of day)
- PL heartbeat: DISABLED
- 16 agents in openclaw.json: 4 orchestrators + 7 BMM/TEA + 5 Research
- Research Lead allowlist: mary, carson, victor, maya, quinn
- Project Lead allowlist: john, sally, winston, bob, amelia, barry, murat
- Dashboard: localhost:3000 (15min session window, 120min research window)
