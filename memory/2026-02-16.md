# 2026-02-16 - Kelly Router Factory Monitoring

## Critical Blocker (Ongoing)

**fleai-market project BLOCKED for ~6 hours (15:28-21:29 CST)**

### Root Cause
- INCORRECT: Attempted to introduce codex CLI harness (exec tool with pty:true)
- CORRECT: First 7 stories succeeded with direct coding (Amelia using write/edit tools)
- 2/3 test stories failed with analysis paralysis (E2-S1-v2, E8-S2-v2) after harness introduction
- 1 story pending (E1-S6-v2), likely same failure
- **The mistake:** Introducing a codex CLI harness when direct coding was working

### Impact
- 7/67 stories complete (using OLD harness before update)
- 57 stories blocked awaiting harness fix
- Project stalled in Implementation phase

### Resolution Path
- Rollback plan exists: `/Users/austenallred/clawd/ROLLBACK-PLAN-CODEX-HARNESS.md`
- Plan says: Revert to OLD approach (direct coding with write/edit tools, NO codex CLI)
- **Rollback was NEVER EXECUTED** - project sat blocked 6+ hours
- Operator decision needed: Execute rollback to direct coding approach
- Would unblock 57 pending stories by returning to what worked

### Session Management Issue
- factory-state.md incorrectly referenced dead v3 session (0794db11-34f6-414e-a724-2751ab62d31a)
- Actual active session: v4 (732ef974-2a86-4aea-b03e-bcba36302f17)
- Corrected in 21:29 CST update
- v4 last activity: 21:08 CST (within acceptable range)

## Heartbeat Monitoring Pattern

Kelly Router performs factory-level health checks every 5 minutes:
1. Check for BLOCKED projects (>30min in same phase)
2. Check for dead Project Lead sessions (>30min no activity)
3. Check for cross-project bottlenecks (multiple projects stuck in same stage)

### Today's Alerts Issued
- Multiple alerts for fleai-market blocker (ongoing since 15:28)
- Multiple alerts for session mismatch (v3 reference vs v4 actual)
- Consistently recommended: execute rollback + operator decision

## Research Lead Planning (Completed)

Comprehensive implementation plan completed for Research Lead feature:
- **Plans:** `/skills/factory/kelly-improver/plans/research-lead-v1.md` (39KB)
- **Q&A:** `/skills/factory/kelly-improver/plans/research-lead-v1-qa.md` (15KB)
- **Follow-up:** `/skills/factory/kelly-improver/plans/research-lead-v1-followup.md` (21KB)
- **Timeline:** 9-11 hours AUTO MODE MVP, +4 hours MANUAL MODE (13-15 hours full)
- **Status:** Awaiting operator approval to begin implementation

## Key Decisions Made

1. **Research Lead Architecture**
   - Standalone agent (like Project Lead), not Kelly skill
   - Batch architecture: Single Research Lead compiles 3-5 briefs internally
   - 4 CIS personas: Carson, Victor, Maya, Quinn (all ideation personas)
   - Mary validator: Separate from Quinn (Quinn generates, Mary validates)
   - AUTO MODE first, MANUAL MODE as enhancement

2. **BMAD Workspace Conversion**
   - Convert 5 BMAD personas to OpenClaw workspace structure
   - Extract persona, strip menu system, keep methodologies
   - Target: AGENTS.md, SOUL.md, TOOLS.md format

3. **Product Naming Strategy**
   - Each brief generates: 1 primary + 3-4 alternative names
   - Directory structure: `<name-slug>-YYYY-MM-DD-HH-MM/` (timestamp for ordering)

## Factory State Summary

**Active Projects:** 1 (fleai-market-v4, BLOCKED)
**Completed Projects:** 2 (kelly-dashboard, meeting-time-tracker-web)
**Terminated Projects:** 2 (fleai-market v1, v2)

**Pending Operator Decisions:**
- fleai-market: Execute rollback to OLD harness?
- Research Lead: Approve implementation plan?
- Fast Mode Test #2: Select project (Screenshot Beautifier recommended)

**Infrastructure Status:**
- Chrome CDP Automation: Active (http://127.0.0.1:9222)
- BMAD Agents: All using Sonnet 4.5 orchestrator
- Project Lead: Mechanical file-based routing, unlimited parallelization

---

## Research Lead Architecture Revision (21:40 CST)

**Operator pushback on original plan - CRITICAL corrections:**

1. **Architecture mistake:** Proposed putting agents in agents/ but should be:
   - **Agent configs:** `/Users/austenallred/.openclaw/agents/{agentId}/` (AGENTS.md, SOUL.md, TOOLS.md, IDENTITY.md)
   - **Workspaces:** `/Users/austenallred/.openclaw/workspace-{agentId}/` (auto-created by OpenClaw)
   - Source: openclaw-agents-architecture skill

2. **Batch strategy:** Use Option A (1 Research Lead = 1 idea) for scalability
   - NOT Option B (batched internally)
   - Parallelize Research Leads like Project Leads
   - Kelly spawns 5 Research Leads simultaneously for batch requests

3. **Model choice:** All Sonnet 4.5 confirmed (balanced, cheap)

4. **Timeline REJECTED:**
   - Original: 60-90 min per Research Lead, 9-11 hours implementation
   - **REQUIRED: 20 MIN MAX per Research Lead, 4.5-5 hours implementation**
   - Revised per-Research-Lead timeline:
     - Phase 1: Problem framing (auto) - 2 min
     - Phase 2: CIS ideation (4 personas parallel) - 5-8 min
     - Phase 2.5: Consolidation - 2 min
     - Phase 3: Mary validation (quick check, not deep) - 5-8 min
     - Phase 4: SKIP (no operator interaction in AUTO mode)
     - Phase 5: Brief compilation - 3 min
     - **Total: 17-23 minutes** âœ“

5. **Output location:** projects-queue/ (NOT ideas-queue/)

6. **Scope:** AUTO mode ONLY for MVP. No manual mode.

**Revised implementation breakdown:**
- Phase 1: Create 5 CIS agent configs (carson, victor, maya, quinn, mary) - 2.5-3 hours
- Phase 2: Create Research Lead agent config - 45 min
- Phase 3: Gateway config + Kelly AGENTS.md update - 30 min
- Phase 4: Testing (spawn validation) - 1 hour
- **Total: 4.5-5 hours** (achievable)

**File:** `/Users/austenallred/clawd/skills/factory/kelly-improver/plans/research-lead-v1-revised.md` (19KB)

---

## Research Lead FINAL Architecture (22:14 CST)

**FINAL DECISION: Research Registry Pattern**

**Key innovation:** Shared coordination file (`research-registry.json`) enables deduplication across:
1. Parallel Research Lead sessions (within-batch)
2. Historical projects (existing products)

**Registry structure:**
- `inProgress[]`: Active Research Lead sessions (concept name, description, phase, sessionId)
- `historical[]`: Completed projects (from projects-queue/ and projects/)

**3 Checkpoint Protocol:**
1. **CHECK 1** (Phase 1 end): After problem framing, before CIS spawn
   - Register concept if unique, abort if duplicate
   - Saves 20 min by catching duplicates early
2. **CHECK 2** (Phase 2.5 end): After consolidation, before Mary spawn
   - Concept may have evolved during ideation
   - Update registry entry if still unique, abort if now duplicate
3. **CHECK 3** (Phase 5 start): Before compilation, final safety net
   - Last check before committing effort
   - Unregister from inProgress, add to historical after brief saved

**Abort protocol:** Research Lead detects duplicate â†’ announces to Kelly â†’ clean up â†’ exit gracefully

**Both modes supported:**
- **Single:** 1 idea â†’ 1 brief (23-32 min with registry checks)
- **Batch:** Kelly spawns 5 Research Leads in parallel â†’ 3-5 unique briefs (25-32 min)
  - Kelly generates 5 diverse angles first
  - Each Research Lead checks registry independently
  - 1-2 aborts expected (duplicates caught early)
  - No post-dedup needed (registry handles everything)

**Benefits:**
- Within-batch dedup: Solved via registry coordination
- Historical dedup: Solved via registry.historical
- Early abort: Save 10-20 min by catching duplicates in Phase 1
- Simple: Just a JSON file, atomic read/write
- No Batch Coordinator needed: Research Lead + Registry is sufficient

**Timeline:**
- Per Research Lead: 23-32 min (worst case, no abort)
- Batch: 25-32 min (parallel, longest determines time)
- Implementation: 5.5-6.5 hours

**File:** `/Users/austenallred/clawd/skills/factory/kelly-improver/plans/research-lead-v1-final.md` (24KB)

**Status:** FINAL - Ready to implement ðŸš€

---

## Research Lead FINAL ARCHITECTURE (22:44 CST)

**Corrected phase order - validation BEFORE ideation:**

**Phase 1: Problem Framing** (2-3 min)
- Extract problem hypothesis
- CHECK 1: Registry dedup
- Register in inProgress

**Phase 2: Market Validation** (10-14 min) - **Mary**
- Validate PAIN POINT exists (search volume, user feedback, gaps)
- Pain point score â‰¥6 â†’ continue, <6 â†’ abort (save 25 min)
- CHECK 2: Registry dedup

**Phase 3: CIS Ideation** (5-8 min) - **Carson, Victor, Maya, Quinn**
- Generate 20 NOVEL solutions to VALIDATED pain point
- Quinn participates as CIS persona (TRIZ, systems thinking)
- Informed by Mary's gap analysis

**Phase 3.5: Consolidation** (3-4 min)
- Merge 20 â†’ select BEST solution
- CHECK 3: Registry dedup

**Phase 4: Competitive Deep-Dive** (8-12 min) - **Mary**
- Validate SPECIFIC SOLUTION is differentiated
- Competitive analysis, novelty score, feasibility, business model

**Phase 5: Compilation** (4-5 min)
- CHECK 4: Final registry dedup
- Generate names, compile comprehensive brief
- Unregister (inProgress â†’ historical)

**Total: 32-46 min per research session**

**Key improvements over old order:**
- Validate market FIRST (don't generate solutions to non-existent problems)
- Abort early if no pain point (save 25 min before CIS)
- CIS generates novel solutions to VALIDATED pain
- Mary does both market validation (Phase 2) AND competitive validation (Phase 4)
- Quinn is part of CIS ideation (Phase 3), not separate validator

**File:** `/Users/austenallred/clawd/skills/factory/kelly-improver/docs/research-lead-v1.md` (22KB)

**Status:** FINAL - Ready to implement ðŸš€

---

## Pre-Compaction State Summary (22:49 CST)

**Current Kelly Router Focus:** Research Lead implementation planning (FINAL architecture approved)

**Architecture decisions locked:**
1. **Agent structure:** Agent configs in `.openclaw/agents/{agentId}/`, workspaces auto-created
2. **Batch strategy:** 1 Research Lead = 1 idea (parallel spawning like Project Leads)
3. **Deduplication:** Research Registry pattern (`research-registry.json`) with 4 checkpoints
4. **Timeline:** 20 min baseline, 23-32 min with registry checks (includes validation + ideation)
5. **Model:** All Sonnet 4.5 for 5 agents (Carson, Victor, Maya, Quinn, Mary)
6. **Scope:** AUTO mode only (MVP), no manual mode
7. **Output:** `projects-queue/` directory structure

**Phase sequence (FINAL):**
- Phase 1: Problem Framing (2-3 min) + CHECK 1
- Phase 2: Market Validation - Mary (10-14 min) + CHECK 2
- Phase 3: CIS Ideation - 4 personas parallel (5-8 min)
- Phase 3.5: Consolidation (3-4 min) + CHECK 3
- Phase 4: Competitive Deep-Dive - Mary (8-12 min)
- Phase 5: Compilation (4-5 min) + CHECK 4

**Registry structure:**
```json
{
  "inProgress": [
    {
      "sessionId": "agent:research-lead:...",
      "conceptName": "Meeting Cost Tracker",
      "briefDescription": "Real-time meeting cost calculator",
      "phase": "validation",
      "timestamp": "2026-02-16T22:00:00-06:00",
      "angle": "meeting efficiency"
    }
  ],
  "historical": [
    {
      "projectPath": "projects-queue/screenshot-beautifier-2026-02-16-21-00/",
      "conceptName": "Screenshot Beautifier",
      "briefDescription": "Add browser chrome and shadows to screenshots"
    }
  ]
}
```

**Implementation breakdown:**
1. Create 5 CIS agent configs (Carson, Victor, Maya, Quinn, Mary) - 2.5-3 hours
2. Create Research Lead agent config with registry logic - 45 min
3. Update gateway config + Kelly AGENTS.md - 30 min
4. Test spawn + registry coordination - 1 hour
5. **Total: 5-5.5 hours to completion**

**Awaiting operator:**
- Go/no-go on Research Lead implementation (FINAL plan complete 23:08 CST)
- Project selection for Fast Mode Test #2 (Screenshot Beautifier recommended)
- fleai-market v4: Check Story 1.4 test status (session may be stalled)

---

## Research Lead FINAL FINAL Architecture (23:08 CST)

**Complete planning document:** `/skills/factory/kelly-improver/docs/research-lead-v1.md` (36KB)

**Critical decisions locked in:**

1. **Zero Kelly input** - Fully autonomous
   - Mary discovers trending pain points with NO direction
   - No "angles" or "domains" provided
   - Market research DRIVES idea generation (not validates it)

2. **Mary makes ALL decisions**
   - Pain point selection (Phase 1): Mary scores 8-12 candidates, picks best one
   - Solution selection (Phase 4): Mary scores 15-20 CIS ideas, picks best one
   - Research Lead is PURE orchestrator (zero decision-making)

3. **Data sources for Phase 1** (Mary's autonomous discovery):
   - Reddit (r/SaaS, r/Entrepreneur, r/productivity, etc.)
   - Hacker News (Ask HN, Show HN comments)
   - Twitter/X (trending complaints, high engagement)
   - Google Trends (rising queries)
   - Product Hunt (comment sections, feature requests)
   - App Store/Play Store (1-2 star reviews)
   - Indie Hackers (founder pain points)

4. **Scoring system** (Phase 1):
   - Severity (1-10): How intense is the pain?
   - Frequency (1-10): How many mentions?
   - Market Signals (1-10): Willingness to pay indicators
   - SaaS Feasibility (1-10): Can we build it? Competitive gaps?
   - Total: 4-40 points per pain point
   - Mary picks highest scoring pain point

5. **Solution selection** (Phase 4):
   - CIS generates 15-20 solutions
   - Mary does quick competitive scan on each
   - Scores: Novelty, Market Fit, Feasibility, Differentiation
   - Mary picks best solution (Research Lead just receives it)

6. **Registry lifecycle clarified:**
   - `historical[]` ONLY removed when project manually deleted from projects-queue
   - Stays in historical even after project moves to implementation
   - Permanent deduplication record

7. **Timeline finalized:**
   - Per session: 36-52 min (target: ~40 min average)
   - Implementation: 5-5.5 hours
   - Phase breakdown:
     - Phase 1 (Mary discovery): 12-17 min
     - Phase 2 (Registration): 2 min + CHECK 1
     - Phase 3 (CIS ideation): 5-8 min
     - Phase 4 (Mary selection): 5-8 min + CHECK 2
     - Phase 5 (Mary deep-dive): 8-12 min
     - Phase 6 (Compilation): 4-5 min + CHECK 3

**Document includes:**
- Complete phase-by-phase breakdown with detailed prompts
- Mary's Phase 1 process (source sweep, scoring, selection)
- Registry structure, lifecycle, atomic operations
- Implementation checklist (28 tasks)
- Testing plan (4 test scenarios)
- Kelly spawn protocol updates
- Gateway config changes
- Rollback plan
- Success metrics

**Status:** ðŸš€ READY FOR IMPLEMENTATION - awaiting operator go signal

**Skills referenced during planning:**
- `factory/kelly-improver/openclaw-agents-architecture/SKILL.md` - agent vs workspace structure
- `factory/kelly-improver/openclaw/SKILL.md` - OpenClaw documentation
- `factory/kelly-improver/bmad/SKILL.md` - BMAD personas and workflows

**CIS Personas discovered (all in `projects/bug-dictionary/_bmad/cis/agents/`):**
1. Carson - `brainstorming-coach.md` (divergent thinking)
2. Victor - `innovation-strategist.md` (Blue Ocean, "incremental thinking means obsolete")
3. Maya - `design-thinking-coach.md` (human-centered design)
4. Quinn - `creative-problem-solver.md` (TRIZ, systems thinking)
5. Mary - `_bmad/bmm/agents/analyst.md` (validation, market research)

**Key files created:**
- `/docs/research-lead-plan.md` (16KB) - high-level overview
- `/skills/factory/kelly-improver/plans/research-lead-v1.md` (39KB) - detailed implementation
- `/skills/factory/kelly-improver/plans/research-lead-v1-qa.md` (15KB) - Q&A doc
- `/skills/factory/kelly-improver/plans/research-lead-v1-followup.md` (21KB) - follow-up decisions
- `/skills/factory/kelly-improver/plans/research-lead-v1-revised.md` (19KB) - revised after operator feedback
- `/skills/factory/kelly-improver/docs/research-lead-v1.md` (22KB) - FINAL architecture
