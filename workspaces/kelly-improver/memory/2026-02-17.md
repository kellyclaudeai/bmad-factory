# 2026-02-17 - Kelly Memory

## BMAD Agent Workspace Audit (10:30-10:45 CST)

**Context:** Operator requested full audit of all BMAD agent workspaces (Amelia, Bob, John, Sally, Winston).

**Audit Scope:**
- AGENTS.md, SOUL.md, TOOLS.md, IDENTITY.md, USER.md, HEARTBEAT.md
- memory/ directories
- Skills availability
- File comparison across all 7 workspaces (5 BMAD + Kelly + Project Lead)

**Key Findings:**

1. **File Coverage:**
   - ✅ All agents have core files (AGENTS.md, SOUL.md, TOOLS.md)
   - ❌ BMAD agents missing IDENTITY.md, USER.md, HEARTBEAT.md
   - ✅ Only Kelly + Project Lead have complete workspace files
   - ❌ No agent (including Kelly) has memory/ directory yet

2. **Agent Roles Clear:**
   - **Amelia:** Developer (Codex CLI orchestrator) - gpt-5.3-codex
   - **Bob:** Scrum Master (parallelization, story files)
   - **John:** Product Manager (PRD, epics/stories)
   - **Sally:** UX Designer (design docs, user flows)
   - **Winston:** Architect (tech stack, data models) - claude-opus-4-6
   - **Kelly:** Router/Orchestrator (me!)
   - **Project Lead:** Project Manager (per-project orchestration)

3. **Missing Agents:**
   - **Barry:** Fast Track Builder (Quick Flow solo dev) - no workspace exists
   - **Mary:** Research/Validation (CIS workflow) - referenced in memory, no workspace
   - **Quinn:** QA/Testing (CIS ideation persona) - referenced in memory, no workspace

4. **Skills Audit:**
   - Amelia: coding-agent ✅, bmad ✅
   - Bob: bmad ✅
   - John: bmad ✅
   - Sally: bmad ✅, ios-native-design ⚠️, frontend-design ⚠️
   - Winston: bmad ✅, firebase-cli ⚠️, oauth-automation ⚠️
   - Platform skills marked ⚠️ = referenced but availability unclear

5. **Critical Gaps:**
   - No memory/ directories = agents can't learn from past work
   - BMAD agents have no persistent identity (spawned fresh each time, but still helpful)
   - Limited error recovery (Amelia: 2 retries only)
   - Platform skills availability unclear

**Recommendations Created:**

**Immediate (High Priority):**
1. Add memory/ directories to all BMAD agent workspaces
2. Create Barry workspace for Quick Flow track
3. Document skill availability and fallback strategies
4. Add IDENTITY.md/USER.md to BMAD agents

**Short-term (Medium Priority):**
5. Improve error recovery in Amelia (beyond 2 retries)
6. Add mockup generation to Sally (image skills)
7. Infrastructure-as-code templates for Winston
8. Expand Kelly HEARTBEAT.md with more factory checks

**Long-term (Nice to Have):**
9. Post-mortem templates for memory/ directories
10. Pattern libraries (architecture, UX, implementation)
11. Agent performance metrics (stories/hour, error rates)
12. Cross-agent learning (share memory insights)

**Status:** ⏸ Awaiting operator direction on which improvements to prioritize

**Lessons Learned:**
- Project Lead workspace is the gold standard (most complete)
- Kelly workspace (mine) also well-structured but missing memory/
- BMAD agents are lean (AGENTS/SOUL/TOOLS only) because spawned fresh
- Need to balance "spawned fresh" nature with persistent learning

**Next Steps:**
- Operator will choose priority improvement
- Likely: Add memory/ directories OR Create Barry workspace OR Improve Amelia error recovery

---

## Factory Architecture Documentation Project (12:00-ongoing)

**Context:** Complete audit and documentation of factory architecture with 4 modes (Normal/Fast × Greenfield/Brownfield). Preparing to rewrite all BMAD agent workspace files based on approved architecture.

**Source of Truth:**
- BMAD Workflow Map: https://docs.bmad-method.org/reference/workflow-map/
- Local BMAD Installation: `/Users/austenallred/clawd/projects/fleai-market-v4/_bmad`
- Diagram: `/Users/austenallred/Sync/factory-architecture-diagram.jpg`
- Review Document: `/Users/austenallred/Sync/factory-architecture-v2.md` (14KB, awaiting feedback)

**Key Architecture Decisions:**
1. **4 Modes:** Normal Greenfield, Normal Brownfield, Fast Greenfield, Fast Brownfield
2. **4 Phases:** Plan → Implement → Test → User QA → Ship (with fail loops at Implement, Test, User QA)
3. **Story completion = dev-story + code-review:** Two separate sequential Amelia spawns required
4. **Dependency-based parallelization:** Check dependency-graph.json every 60s, spawn ALL stories with cleared deps IN PARALLEL (unlimited parallelization - could spawn 1, 5, 10+ Amelias simultaneously)
5. **Mode detection:** Automatic Greenfield/Brownfield (check .git, package.json), default Normal unless explicit Fast Mode flag
6. **Use "Mode" not "Track" terminology**
7. **John: create-prd and create-epics-and-stories are SEPARATE commands**
8. **John (not Winston) does check-implementation-readiness gate check**
9. **Bob creates dependency-graph.json:** Custom factory logic (NOT a BMAD workflow) - parses epics.md for dependencies, creates parallelization graph
10. **Document organized by MODE first, then phases within each mode**
11. **Two H2 sections:** Project Lead Flow (complete) and Research Lead Flow (to be mapped)

**BMAD Workflow Discoveries:**

### Brownfield Workflows
- **`document-project`**: Analyzes existing codebases and creates comprehensive documentation
  - Located: `_bmad/bmm/workflows/document-project/`
  - Purpose: Brownfield entry point - understand existing code before planning
  - Outputs: Project documentation, architecture analysis, code inventory
  
- **`generate-project-context`**: Creates project-context.md from existing code
  - Located: `_bmad/bmm/workflows/generate-project-context/`
  - Purpose: Generate context file for BMAD agents working on brownfield projects
  - Outputs: project-context.md with codebase structure, patterns, dependencies

### Testing Workflows (TEA Module)
- **TEA (Test Architect)**: 8 comprehensive testing workflows
  - Located: `_bmad/tea/workflows/testarch/`
  - Workflows discovered:
    1. `test-design` - Design test strategy and test cases
    2. `automate` - Convert manual tests to automated tests
    3. `atdd` - Acceptance Test-Driven Development
    4. `test-review` - Review existing tests for quality/coverage
    5. `trace` - Trace requirements to tests (traceability matrix)
    6. `framework` - Set up test frameworks (Jest, Vitest, Playwright, etc.)
    7. `ci` - Configure CI/CD test integration
    8. `nfr-assess` - Non-functional requirements testing (performance, security, etc.)

### User Feedback Workflows
- **`correct-course`**: Handle mid-sprint changes/user feedback
  - Located: `_bmad/bmm/workflows/4-implementation/correct-course/`
  - Purpose: Adjust sprint plan when user provides feedback during implementation
  - Triggers: User says "change X" or "we need Y instead"
  
- **`retrospective`**: Epic completion review and lessons learned
  - Located: `_bmad/bmm/workflows/4-implementation/retrospective/`
  - Purpose: Post-epic reflection, gather user feedback, adjust approach for next epic

### BMAD File Structure
```
_bmad-output/
├── planning-artifacts/
│   ├── prd.md (John)
│   ├── ux-design.md (Sally)
│   ├── architecture.md (Winston)
│   └── epics.md (John)
├── implementation-artifacts/
│   ├── sprint-status.yaml (Bob - sprint metadata)
│   ├── dependency-graph.json (Bob - parallelization)
│   └── stories/
│       ├── story-1.1.md (Bob creates from epic)
│       ├── story-1.2.md
│       └── ... (all stories)
└── quick-flow/
    └── tech-spec.md (Barry - Fast Mode only)
```

**Open Questions (awaiting research completion):**
1. ✅ Brownfield workflows - ANSWERED (document-project + generate-project-context)
2. ✅ Test phase workflows - ANSWERED (TEA module with 8 workflows)
3. ✅ User feedback handling - ANSWERED (correct-course + retrospective)
4. ⏸ Barry's flat numbered lists - Need strategy for long-term tracking (no Story N.M format)

**Document Evolution:**
- **v2.0:** Initial draft with 4 modes, 4 phases
- **v2.1:** Added unlimited parallelization clarification
- **v2.2:** Documented dependency-based parallelization example
- **v2.3 (14:05 CST):** MAJOR REORGANIZATION
  - Changed from "Phases → Modes" to "Mode → Phases"
  - Bob now creates dependency-graph.json (custom factory logic)
  - Added H2 sections: "Project Lead Flow" and "Research Lead Flow"
  - Clearer separation of BMAD workflows vs custom factory logic
  - **4 modes ONLY exist within Project Lead Flow** (Research Lead has its own structure)

**Workspace Rewrites Complete (14:28 CST):**

| Workspace | Status | Key Changes |
|-----------|--------|-------------|
| Project Lead | ✅ REWRITTEN | 4 modes, 4 phases, dependency polling, git workflow, mode selection simplified |
| Bob | ✅ REWRITTEN | 3 commands + dependency-graph.json (custom logic), aligned file naming |
| Amelia | ✅ REWRITTEN | dev-story vs code-review as separate spawns, git workflow (dev branch) |
| John | ✅ REWRITTEN | 3 separate spawns (create-prd, create-epics, check-implementation-readiness) |
| Barry | ✅ REWRITTEN | quick-spec + quick-dev, git workflow, n+1 brownfield tracking |
| Sally | ✅ UPDATED | Added BMAD command reference, cleaned TOOLS.md |
| Winston | ✅ UPDATED | Added BMAD command reference, cleaned TOOLS.md |
| Murat (TEA) | ✅ CREATED NEW | Full workspace: AGENTS.md + SOUL.md + TOOLS.md |

**All SOUL.md files verified/updated. All TOOLS.md files aligned with BMAD commands.**

**Architecture doc at v2.4** with:
- Git workflow (dev branch, merge to main at Ship)
- Mode selection simplified (default Normal Greenfield)
- John confirmed for check-implementation-readiness
- Murat replaces Quinn for TEA

**Skill Consolidation Complete (14:44 CST):**

**Deleted (consolidated into AGENTS.md):**
- `skills/factory/barry-fast-mode/` → Barry's AGENTS.md
- `skills/factory/barry-brownfield-protocol.md` → Barry's AGENTS.md
- `skills/factory/project-lead/spawning-protocol/` → PL AGENTS.md
- `skills/factory/project-lead/artifact-tracking/` → PL AGENTS.md
- `skills/factory/project-lead/state-management/` → PL AGENTS.md
- `skills/factory/project-lead/quality-gates/` → PL AGENTS.md

**Kept:**
- `factory-architecture/` — Orchestrator-only skill (Kelly, PL, RL)
- `kelly-improver/` — Kelly's sub-skills
- `memory-system-v2/` — Shared utility
- `project-closer/` — Shared utility
- `project-lead-instantiator/` — Kelly uses for PL sessions
- `session-closer/` — Shared utility

**Heuristic established:**
- If only one agent needs it → AGENTS.md
- If multiple agents share it → skill
- If it's "how to use an external tool" → skill
- If it's "how to do your job" → AGENTS.md

**Skills & Docs Created (14:44-15:00 CST):**
- Wrote `skills/factory/factory-architecture/SKILL.md` with v2.4 content + orchestrator-only audience note
- Created `docs/FACTORY-ARCHITECTURE.md` (public-facing copy)
- Created `skills/factory/project-lead-flow/SKILL.md` (PL-specific orchestration detail)

**Factory Skills Audit (15:00-15:30 CST):**
- Deep-read `spawning-protocol/SKILL.md` (601 lines) — found multiple outdated references:
  - Quinn→Murat (TEA agent rename)
  - stories-parallel.json→dependency-graph.json
  - Stage naming misalignment with 4-phase model
  - check-implementation-readiness gate not reflecting John assignment
  - correct-course workflow not documented
  - Brownfield mode handling missing
- Read `barry-fast-mode/`, `barry-brownfield-protocol/`, `project-lead-instantiator/`
- Read `project-lead/` sub-skills: artifact-tracking, quality-gates, spawning-protocol, state-management
- **6 skills deleted** (consolidated into AGENTS.md per heuristic: one-agent → AGENTS.md, multi-agent → skill)
- **6 skills kept**: factory-architecture, kelly-improver, memory-system-v2, project-closer, project-lead-instantiator, session-closer

**Remaining Audit Items (not yet done):**
- `kelly-improver/` sub-skills (openclaw, openclaw-agents-architecture, security-audit, skill-creator)
- `memory-system-v2/` — shared utility, likely fine
- `project-closer/` and `session-closer/` — shared utilities
- Verify TOOLS.md files: only orchestrators (Kelly, PL, RL) should reference factory-architecture skill
- Fix outdated refs in spawning-protocol (already deleted, but check if PL AGENTS.md absorbed correctly)

**Next Steps:**
1. ⏭️ Complete remaining factory skills audit
2. ⏭️ Fix any outdated references found
3. ⏭️ Map out Research Lead Flow (operator creating)
4. ⏭️ Test the updated architecture on a real project
