# Story 8: Project Detail Subagent Grid - Implementation Spec

## Context
Building the subagent grid section for the project detail page. Stories 1-6 complete (scaffold, API routes, Factory View components). Story 7 is building project header (parallel). We handle the subagent grid below the header.

## Files to Create

### 1. `components/project-view/subagent-card.tsx`
**Type:** Client Component (needs click handler for navigation)
**Purpose:** Display individual subagent information as a clickable card

**Props:**
```typescript
interface SubagentCardProps {
  sessionKey?: string;
  story: string;
  status: 'active' | 'complete' | 'queued';
  startedAt?: string;
  completedAt?: string;
  duration?: string;
  branch?: string;
}
```

**Behavior:**
- Display persona name extracted from story (e.g., "Story 7: Project Detail Header" â†’ show "Story 7")
- Show status badge with color coding:
  - active: green text/border
  - complete: dim green
  - queued: amber
- Display timestamps:
  - If active: show "Started" + relative time using `<Timestamp />` component
  - If complete: show duration string (e.g., "8m14s")
  - If queued: show "Pending"
- Click handler: navigate to `/subagent/[sessionKey]` if sessionKey exists
- Style: Card component from shadcn/ui, terminal theme colors, hover effect (border glow)

**Implementation notes:**
- Use `'use client'` directive
- Import: `useRouter` from `next/navigation`, `Card` from `@/components/ui/card`, `Timestamp` from `@/components/shared/timestamp`, `Badge` from `@/components/ui/badge`
- Cursor should be pointer on hover if sessionKey exists
- Disable click if no sessionKey (for queued items)

### 2. `components/project-view/subagent-grid.tsx`
**Type:** Client Component (needs collapsible state)
**Purpose:** Group and display subagents by status in 3 collapsible sections

**Props:**
```typescript
interface SubagentGridProps {
  subagents: Array<{
    sessionKey?: string;
    story: string;
    status: string;
    startedAt?: string;
    completedAt?: string;
    duration?: string;
    branch?: string;
  }>;
}
```

**Behavior:**
- Group subagents into 3 categories:
  1. **Live/Active:** `status === 'active'`
  2. **Past/Complete:** `status === 'complete'`
  3. **Queued/Pending:** `status === 'queued'` or `status === 'pending'`
- Each section:
  - Collapsible header with section title + count
  - Starts expanded for Live, collapsed for others
  - Grid layout: 2 columns on desktop, 1 on mobile
  - Empty state: "No {section} subagents" in dim text
- Section titles:
  - "Live Subagents" (green)
  - "Past Subagents" (dim)
  - "Queued Subagents" (amber)
- Use SubagentCard for each item

**Implementation notes:**
- Use `'use client'` directive
- Import: `useState` from `react`, `SubagentCard`, `ChevronDown/ChevronRight` icons
- Each section has toggle button (chevron icon rotates)
- Grid: `grid grid-cols-1 md:grid-cols-2 gap-4`

## Type Definitions
Reference existing patterns:
- Use `@/components/ui/*` for shadcn components
- Use `@/components/shared/*` for shared utilities
- Terminal colors: `text-terminal-green`, `text-terminal-amber`, `text-terminal-red`, `text-terminal-dim`
- Card hover: `hover:border-terminal-green hover:shadow-[0_0_10px_rgba(0,255,136,0.1)]`

## Styling Requirements
- Terminal aesthetic: dark background, monospace fonts for labels, green/amber/red accents
- Consistent with existing components (see `components/factory-view/stats-cards.tsx`)
- Smooth transitions (200ms) on hover and collapse
- Loading skeleton: use shadcn Skeleton component if needed

## Testing Data Shape
From project-state.json:
```json
{
  "sessionKey": "agent:bmad-bmm-barry:subagent:80be4ae7-5c07-4ae7-97b6-0616d58cd9f0",
  "story": "Story 7: Project Detail Header + Metrics",
  "status": "active",
  "startedAt": "2026-02-15T17:18:00.000Z",
  "branch": "barry-7"
}
```

## Success Criteria
1. SubagentCard displays all required info (story, status, timestamps)
2. SubagentCard navigates to detail page on click (if sessionKey exists)
3. SubagentGrid groups subagents correctly (live/past/queued)
4. Sections are collapsible with smooth animation
5. Grid layout responsive (2 cols desktop, 1 col mobile)
6. Terminal styling consistent with existing components
7. Empty states handled gracefully

## Implementation Steps
1. Create `components/project-view/subagent-card.tsx` with all props and handlers
2. Create `components/project-view/subagent-grid.tsx` with grouping logic
3. Test with sample data
4. Verify styling matches terminal theme
