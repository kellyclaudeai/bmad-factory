# ============================================================
# Firebase App Hosting Configuration
# Story 14.1 — Verified & Updated (2026-02-20)
# ============================================================
#
# PROJECT: slacklite-prod
# DEPLOYMENT TYPE: Firebase App Hosting (SSR via Cloud Run)
#   - This is NOT static Firebase Hosting.
#   - App Hosting reads THIS file (apphosting.yaml), NOT firebase.json hosting.
#   - Do NOT add output: 'export' to next.config.mjs — breaks SSR + API routes.
#   - Previous Cloud Run URL: https://slacklite-286897557836.us-central1.run.app
#
# VERIFICATION FINDINGS (Story 14.1):
#   ✅ .firebaserc points to slacklite-prod
#   ✅ firebase use confirms active project: slacklite-prod
#   ✅ next.config.mjs does NOT have output: 'export' (SSR intact)
#   ✅ next.config.mjs only (no conflicting next.config.ts)
#   ✅ firebase.json has legacy hosting section — fine, App Hosting ignores it
#   ⚠️  firebase apphosting:backends:list returned empty — backend must be created
#       in Story 14.2 with: firebase apphosting:backends:create --project slacklite-prod --location us-central1
#   ✅  apphosting.yaml env section updated below with all required Firebase config vars
#
# ENV VAR STRATEGY:
#   - NEXT_PUBLIC_* vars: stored as direct values (client-side, not truly secret)
#   - FIREBASE_PRIVATE_KEY: must be set as an App Hosting secret before deploying:
#       firebase apphosting:secrets:set firebase-private-key
#       firebase apphosting:secrets:set firebase-client-email
#   - See .env.local for values to use when setting secrets
# ============================================================

runConfig:
  cpu: 1
  memoryMiB: 512
  concurrency: 80
  minInstances: 0
  maxInstances: 10

env:
  - variable: NODE_ENV
    value: production
    availability:
      - BUILD
      - RUNTIME

  # Firebase client-side config (NEXT_PUBLIC_* — safe to store as values)
  - variable: NEXT_PUBLIC_FIREBASE_API_KEY
    value: "AIzaSyChWv2aPWtIuY3o8v-PI4QSjiBnxD3Egps"
    availability:
      - BUILD
      - RUNTIME

  - variable: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
    value: "slacklite-prod.firebaseapp.com"
    availability:
      - BUILD
      - RUNTIME

  - variable: NEXT_PUBLIC_FIREBASE_PROJECT_ID
    value: "slacklite-prod"
    availability:
      - BUILD
      - RUNTIME

  - variable: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
    value: "slacklite-prod.firebasestorage.app"
    availability:
      - BUILD
      - RUNTIME

  - variable: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
    value: "286897557836"
    availability:
      - BUILD
      - RUNTIME

  - variable: NEXT_PUBLIC_FIREBASE_APP_ID
    value: "1:286897557836:web:b7bf30eec0ad6bfd837fe9"
    availability:
      - BUILD
      - RUNTIME

  - variable: NEXT_PUBLIC_FIREBASE_DATABASE_URL
    value: "https://slacklite-prod.firebaseio.com"
    availability:
      - BUILD
      - RUNTIME

  # Firebase Admin SDK — server-side only (set as App Hosting secrets before deploying)
  # Run before 14.2 deploy:
  #   firebase apphosting:secrets:set firebase-client-email
  #   firebase apphosting:secrets:set firebase-private-key
  - variable: FIREBASE_PROJECT_ID
    value: "slacklite-prod"
    availability:
      - RUNTIME

  - variable: FIREBASE_CLIENT_EMAIL
    secret: firebase-client-email

  - variable: FIREBASE_PRIVATE_KEY
    secret: firebase-private-key
